<!-- Included in home.html -->

<div id="container" style="width: 100%; height: 40vh;">
  <canvas id="canvas"></canvas>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  window.onload = () => {
    const words = [
      { key: "people", value: 30 },
      { key: "vaccination", value: 27 },
      { key: "pfizer", value: 26 },
      { key: "astrazaneca", value: 20 },
      { key: "shots", value: 19 },
      { key: "covidshield", value: 17 },
      { key: "virus", value: 14 },
      { key: "homeless", value: 10 },
      { key: "rollout", value: 5 },
      { key: "coronavirus", value: 4 },
      { key: "health", value: 3 }
    ];

    // const colors = ["#331E36", "#A6D49F", "#4A7B9D", "#56A3A6", "#E58F65", "#D5A021", "#93253B"]; // #331E36 does not show up on dark mode
    // const colors = ["#A6D49F", "#4A7B9D", "#56A3A6", "#E58F65", "#D5A021", "#93253B", "#EDE7D9"]; // #EDE7D9 does not show up on light mode
    const colors = ["#A6D49F", "#4A7B9D", "#56A3A6", "#E58F65", "#D5A021", "#93253B"];

    const getRandomColor = () => colors[Math.floor(Math.random() * colors.length)];

    const data = {
      labels: words.map((d) => d.key),
      datasets: [
        {
          label: '',
          data: words.map((d) => 10 + d.value),
          originalData: words.map((d) => d.value),
          color: words.map(() => getRandomColor())
        },
      ],
    };

    const ctx = document.getElementById('canvas').getContext('2d');
    const myBar = new Chart(ctx, {
      type: 'wordCloud',
      data: data,
      options: {
        title: {
          display: false,
          text: 'Chart.js Word Cloud',
        },
        plugins: {
          legend: {
            display: false,
          },
          tooltip: {
            callbacks: {
              label: function (context) {
                const originalValue = context.dataset.originalData[context.dataIndex];
                return `${context.label}: ${originalValue}`;
              },
              labelColor: function (context) {
                const index = context.dataIndex;
                const color = context.dataset.color[index];
                return {
                  borderColor: color,
                  backgroundColor: color
                };
              }
            }
          },
        },
        // Listen for wordcloud word click
        onClick: (event, elements) => {
          if (elements.length > 0) {
            const element = elements[0];
            const word = data.labels[element.index];

            // Check if the word already exists in the table
            let wordExists = false;
            $('#keyword-rows td:nth-child(2)').each(function () {
              if ($(this).text() === word) {
                wordExists = true;
                return false; // Exit the loop
              }
            });

            if (!wordExists) {
              const value = data.datasets[0].originalData[element.index];

              // Add word and value to word table
              const newValue =
                `<tr>
                  <td><button type="button" class="btn btn-trash b-0" id="del-word-btn" aria-label="Delete"><i class="bi bi-trash"></i></button></td>
                  <td>${word}</td>
                  <td>${value}</td>
                </tr>`;
              // Add new row to bottom of rows
              $('#keyword-rows').append(newValue);
            }
          }
        }
      },
    });

    // Listen for delete button click
    $('#keyword-rows').on('click', '#del-word-btn', function () {
      // Fetch nearest table row and delete
      console.log("delete clicked");
      $(this).closest('tr').remove();
    });
  };
</script>
